# Project: snake_game
# Auto-generated by Code Agent

import pygame
import random

pygame.init()

# 设置窗口大小
WINDOW_WIDTH = 640
WINDOW_HEIGHT = 480
screen = pygame.display.set_mode((WINDOW_WIDTH, WINDOW_HEIGHT))
pygame.display.set_caption('贪吃蛇游戏')

# 定义颜色
BLACK = (0, 0, 0)
WHITE = (255, 255, 255)
GREEN = (0, 255, 0)
RED = (255, 0, 0)

# 蛇的初始位置和大小
snake_block_size = 10
snake_speed = 15
snake_list = [[100, 50], [90, 50], [80, 50]]
clock = pygame.time.Clock()

# 食物的初始位置
foodx = round(random.randrange(0, WINDOW_WIDTH - snake_block_size) / 10.0) * 10.0
foody = round(random.randrange(0, WINDOW_HEIGHT - snake_block_size) / 10.0) * 10.0

# 游戏循环标志
game_over = False
game_close = False
x1_change = 0
y1_change = 0
length_of_snake = len(snake_list)
score = 0

while not game_over:
    while game_close == True:
        screen.fill(BLACK)
        message('You Lost! Press Q-Quit or C-Play Again', RED)
        pygame.display.update()
        for event in pygame.event.get():
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_q:
                    game_over = True
                    game_close = False
                if event.key == pygame.K_c:
                    gameLoop()
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            game_over = True
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_LEFT:
                x1_change = -snake_block_size
                y1_change = 0
            elif event.key == pygame.K_RIGHT:
                x1_change = snake_block_size
                y1_change = 0
            elif event.key == pygame.K_UP:
                y1_change = -snake_block_size
                x1_change = 0
            elif event.key == pygame.K_DOWN:
                y1_change = snake_block_size
                x1_change = 0
    if x1 >= WINDOW_WIDTH or x1 < 0 or y1 >= WINDOW_HEIGHT or y1 < 0:
        game_close = True
    x1 += x1_change
    y1 += y1_change
    screen.fill(BLACK)
    foodx, foody = generate_food(snake_list, WINDOW_WIDTH, WINDOW_HEIGHT, snake_block_size)
    pygame.draw.rect(screen, GREEN, [foodx, foody, snake_block_size, snake_block_size])
    snake_list = move_snake(snake_block_size, snake_list, x1_change, y1_change)
    collision = check_collision(snake_list, foodx, foody)
    if collision == 'eat':
        length_of_snake += 1
        score = update_score(score, collision)
    elif collision == 'lose':
        game_close = True
    draw_snake(snake_block_size, snake_list)
    pygame.display.update()
    clock.tick(snake_speed)
pygame.quit()
quit()

# ============================================================
# Module 2: 实现蛇的移动逻辑
# ============================================================
def move_snake(snake_block_size, snake_list, x1_change, y1_change):
    x1 = snake_list[-1][0]
    y1 = snake_list[-1][1]
    x1 += x1_change
    y1 += y1_change
    new_head = [x1, y1]
    snake_list.append(new_head)
    return snake_list
def check_collision(snake_list):
    head = snake_list[-1]
    if head in snake_list[:-1] or head[0] < 0 or head[0] >= WINDOW_WIDTH or head[1] < 0 or head[1] >= WINDOW_HEIGHT:
        return True
    return False
def draw_snake(snake_block_size, snake_list):
    for x in snake_list:
        pygame.draw.rect(screen, GREEN, [x[0], x[1], snake_block_size, snake_block_size])

# ============================================================
# Module 3: 生成食物
# ============================================================
def generate_food(snake_list, window_width, window_height, snake_block_size):
    foodx = round(random.randrange(0, window_width - snake_block_size) / 10.0) * 10.0
    foody = round(random.randrange(0, window_height - snake_block_size) / 10.0) * 10.0
    while [foodx, foody] in snake_list:
        foodx = round(random.randrange(0, window_width - snake_block_size) / 10.0) * 10.0
        foody = round(random.randrange(0, window_height - snake_block_size) / 10.0) * 10.0
    return foodx, foody

# ============================================================
# Module 4: 处理碰撞检测
# ============================================================
def check_collision(snake_list, foodx, foody):
    head = snake_list[-1]
    if head[0] == foodx and head[1] == foody:
        return 'eat'
    elif head in snake_list[:-1] or head[0] < 0 or head[0] >= WINDOW_WIDTH or head[1] < 0 or head[1] >= WINDOW_HEIGHT:
        return 'lose'
    else:
        return 'continue'
def update_score(score, collision):
    if collision == 'eat':
        score += 1
    return score

# ============================================================
# Module 5: 实现游戏循环
# ============================================================
from snake import move_snake, check_collision, draw_snake
game_over = False
game_close = False
x1_change = 0
y1_change = 0
length_of_snake = len(snake_list)
score = 0
while not game_over:
    while game_close == True:
        screen.fill(BLACK)
        message('You Lost! Press Q-Quit or C-Play Again', RED)
        pygame.display.update()
        for event in pygame.event.get():
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_q:
                    game_over = True
                    game_close = False
                if event.key == pygame.K_c:
                    gameLoop()
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            game_over = True
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_LEFT:
                x1_change = -snake_block_size
                y1_change = 0
            elif event.key == pygame.K_RIGHT:
                x1_change = snake_block_size
                y1_change = 0
            elif event.key == pygame.K_UP:
                y1_change = -snake_block_size
                x1_change = 0
            elif event.key == pygame.K_DOWN:
                y1_change = snake_block_size
                x1_change = 0
    if x1 >= WINDOW_WIDTH or x1 < 0 or y1 >= WINDOW_HEIGHT or y1 < 0:
        game_close = True
    x1 += x1_change
    y1 += y1_change
    screen.fill(BLACK)
    foodx, foody = generate_food(snake_list, WINDOW_WIDTH, WINDOW_HEIGHT, snake_block_size)
    pygame.draw.rect(screen, GREEN, [foodx, foody, snake_block_size, snake_block_size])
    snake_list = move_snake(snake_block_size, snake_list, x1_change, y1_change)
    collision = check_collision(snake_list, foodx, foody)
    if collision == 'eat':
        length_of_snake += 1
        score = update_score(score, collision)
    elif collision == 'lose':
        game_close = True
    draw_snake(snake_block_size, snake_list)
    pygame.display.update()
    clock.tick(snake_speed)
pygame.quit()
quit()